@using CSETWebCore.Reports.Models
@using CSETWebCore.Model.Edm
@using CSETWebCore.Helpers.ReportWidgets
@using System.Text.RegularExpressions
@using System.Xml.Linq
@using DocumentFormat.OpenXml.Office2010.PowerPoint
@model CrrViewModel

<link rel="stylesheet" href="@(TempData["links"]+"/lib/bootstrap/css/bootstrap.min.css")" />
<link rel="stylesheet" href="@(TempData["links"]+"/css/site.css")" />

<style>
    @@media print {
        .function-padding {
            margin-right: 2rem;
        }
    }

    .function-padding {
        margin-right: 2rem;
    }
</style>

@{
    XDocument xDoc = Model.CRRScores.XCsf;
}

<table class="w-100">
    <tr>
        <td rowspan="2" class="ps-5">
            @{
                var distAll = Model.CRRScores.CrrReferenceAnswerDistrib(xDoc.Root);

                var bciAll = new BarChartInput() { Height = 80, Width = 100 };
                bciAll.IncludePercentFirstBar = true;
                bciAll.AnswerCounts = new List<int> { distAll.Green, distAll.Yellow, distAll.Red };
                var chartAll = new ScoreBarChart(bciAll);
            }
            @Html.Raw(chartAll)
        </td>
        <td>
            <h3 class="depiction-title">NIST Cybersecurity Framework Summary</h3>
        </td>
    </tr>
    <tr>
        <td>
            @{
                var legend = new MIL1PerformanceSummaryLegend();
            }
            @Html.Raw(legend.ToString())
        </td>
    </tr>
</table>



<div class="row" style="border-top: 1px solid black;">
    <div class="col-3">
        FUNCTION
    </div>
    <div class="col-9">
        CATEGORY
    </div>
</div>

@foreach (var func in xDoc.Descendants("Function"))
{

    <!-- one function super row -->
    <div class="row" style="padding-top: 5px; border-top: 1px solid black;">
        <div class="col-3">

            <div class="d-flex flex-row" style="min-height: 100%">
                <div class="function-padding" style="background-color: @Model.CRRScores.CsfFunctionColors[func.Attribute("code").Value]; min-width: 1rem; max-width: 1rem; min-height: 100%;margin-bottom: 5px">
                </div>

                <div>
                    <div class="row">
                        <div class="appendix-label">
                            @func.Attribute("name").Value (@func.Attribute("code").Value)
                        </div>
                    </div>
                    <div class="row" style="vertical-align: middle">

                        @{
                            var distFunc = Model.CRRScores.CrrReferenceAnswerDistrib(func);

                            var bciFunc = new BarChartInput() { Height = 80, Width = 100 };
                            bciFunc.IncludePercentFirstBar = true;
                            bciFunc.AnswerCounts = new List<int> { distFunc.Green, distFunc.Yellow, distFunc.Red };
                            var chartFunc = new ScoreBarChart(bciFunc);
                        }
                        @Html.Raw(chartFunc)

                    </div>
                </div>
            </div>
        </div>


        <div class="col-9">

            @foreach (var cat in func.Elements())
            {
                <!-- each category -->
                var s1 = "";
                if (!cat.Equals(func.Elements().Last()))
                {
                    s1 = "border-bottom: solid 1px black;";
                }

                <div class="row gx-1" style="@s1">

                    <div class="col-5" style="font-size: 8px; padding: .3rem 0">
                        <div>
                            <b>
                                @cat.Parent.Attribute("code").Value.@cat.Attribute("code").Value
                            </b>
                        </div>
                        @cat.Attribute("name").Value
                    </div>
                    <div class="col-6 d-flex" style="align-items: center;">

                        @{
                            var distCat = Model.CRRScores.CrrReferenceAnswerDistrib(cat);

                            var bciCat = new BarChartInput() { Height = 15, Width = 360 };
                            bciCat.IncludePercentFirstBar = true;
                            bciCat.AnswerCounts = new List<int> { distCat.Green, distCat.Yellow, distCat.Red };
                            var chartCat = new ScoreStackedBarChart(bciCat);
                        }
                        @Html.Raw(chartCat)

                    </div>
                </div>
            }


        </div>
    </div>

}
