<h3>Collect Observables</h3>
<h5>
    Build a list of all observables relevant for this assessment
</h5>

<br />

<div *ngIf="loading" class="w-100">
    <div class="spinner-container" style="margin: 2em auto">
        <div style="max-width: 50px; max-height: 50px"></div>
    </div>
</div>

<mat-accordion class="example-headers-align observable-list" cdkDropList (cdkDropListDropped)="drop($event)">
    <!-- <mat-list>
        <mat-list-item class="category-title">
          Today
        </mat-list-item>
        <mat-list-item  -->

    <!--
          <mat-card
            class="anomaly"
            *ngFor="let anomaly of cyoteSvc.anomalies; let anomalyIndex = index; let firstAnomaly = first; let lastAnomaly = last"
            cdkDrag> -->

    <mat-expansion-panel class="anomaly" *ngFor="
      let anomaly of cyoteSvc.anomalies;
      let anomalyIndex = index;
      let firstAnomaly = first;
      let lastAnomaly = last;
      trackBy: trackByItems
    " cdkDrag [expanded]="step === anomalyIndex" (opened)="setStep(anomalyIndex)" hideToggle>
        <mat-expansion-panel-header class="example-headers-align" style="display: flex; justify-content: space-between"
            cdkDragHandle>
            <mat-panel-title>
                {{ anomaly.title }}
            </mat-panel-title>
            <mat-panel-description style="justify-content: space-between">
                <span></span>
                <mat-icon *ngIf="
              !anomaly.categories.physical &&
              !anomaly.categories.digital &&
              !anomaly.categories.network
            ">extension</mat-icon>
                <mat-icon *ngIf="anomaly.categories.physical">whatshot</mat-icon>
                <mat-icon *ngIf="anomaly.categories.digital">memory</mat-icon>
                <mat-icon *ngIf="anomaly.categories.network">wifi</mat-icon>
            </mat-panel-description>
        </mat-expansion-panel-header>

        <form class="example-form">
            <mat-form-field class="example-full-width" appearance="fill">
                <mat-label>Title</mat-label>
                <input matInput [(ngModel)]="anomaly.title" name="title" maxlength="128"
                    placeholder="Ex. Mouse Movement" />
                <mat-hint align="start"><strong>Provide a short (3-5 word) description of what you
                        saw</strong>
                </mat-hint>
                <mat-hint align="end">{{ anomaly.title.length }} / 128</mat-hint>
            </mat-form-field>
            <br />
            <br />

            <mat-form-field class="example-full-width" appearance="fill">
                <mat-label>Description</mat-label>
                <textarea autosize [minRows]="3" matInput [(ngModel)]="anomaly.description"
                    name="description"></textarea>
                <mat-hint align="start"><strong>Describe what you saw in more depth</strong>
                </mat-hint>
                <!-- <mat-hint align="end">{{message.value.length}} / 256</mat-hint> -->
            </mat-form-field>
            <br />
            <br />
            <table class="example-full-width" cellspacing="0">
                <tr>
                    <td>
                        <!-- <mat-form-field>
              <mat-placeholder
                >When did this observation happen?</mat-placeholder
              >
              <input
                [(ngModel)]="anomaly.whenThisHappened"
                name="when"
                [mtxDatetimepicker]="datetimePicker"
                [formControl]="datetime"
                matInput
                required
              />
              <mtx-datetimepicker-toggle
                [for]="datetimePicker"
                matSuffix
              ></mtx-datetimepicker-toggle>
              <mtx-datetimepicker
                #datetimePicker
                [type]="datetime"
                [mode]="auto"
                [multiYearSelector]="false"
                [startView]="month"
                [twelvehour]="true"
                [timeInterval]="1"
                [touchUi]="false"
              ></mtx-datetimepicker>
            </mat-form-field> -->

                        <mat-form-field class="example-full-width" appearance="fill">
                            <mat-label>When did this observation happen?</mat-label>
                            <input matInput [matDatepicker]="picker" [(ngModel)]="anomaly.whenThisHappened"
                                name="when" />
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                    </td>

                    <td>
                        <mat-form-field class="example-full-width" appearance="fill">
                            <mat-label>Who reported the observation? </mat-label>
                            <input matInput [(ngModel)]="anomaly.reporter" name="reporter" maxlength="256" />
                        </mat-form-field>
                    </td>
                </tr>
            </table>

            <br />

            <div class="example-full-width" appearance="fill">
                <mat-checkbox class="example-margin" [(ngModel)]="anomaly.isFirstTimeAooHasSeenObservable"
                    name="isFirstTimeAooHasSeenObservable">Is this the first time AOO has seen this
                    observable?</mat-checkbox>
            </div>

            <br />
            <mat-divider></mat-divider>
            <br />
            <!-- Category -->
            <!-- <mat-form-field appearance="fill"> -->
            <mat-label>Select which categories this observable is related to:</mat-label>
            <br />
            <br />
            <!-- </li> -->
            <mat-checkbox class="example-margin" [(ngModel)]="anomaly.categories.physical" name="physical">ICS (Physical
                Equipment)</mat-checkbox>
            <br />
            <mat-checkbox class="example-margin" [(ngModel)]="anomaly.categories.digital" name="digital">Digital (ICS
                Process)</mat-checkbox>
            <br />
            <mat-checkbox class="example-margin" [(ngModel)]="anomaly.categories.network" name="network">Network
            </mat-checkbox>

            <div class="example-full-width" appearance="fill" *ngIf="
          anomaly.categories.physical ||
          anomaly.categories.digital ||
          anomaly.categories.network
        ">
                <br />
                <mat-divider></mat-divider>
                <br />

                <mat-checkbox class="example-margin" [(ngModel)]="anomaly.questions.affectingOperations"
                    name="affectingOperations">Is this affecting operations?</mat-checkbox>

                <mat-form-field *ngIf="anomaly.questions.affectingOperations" class="example-full-width"
                    appearance="fill">
                    <mat-label>Describe the affected operations</mat-label>
                    <textarea autosize [minRows]="3" matInput
                        [(ngModel)]="anomaly.questions.affectingOperationsDescription"
                        name="affectingOperationsDescription"></textarea>
                </mat-form-field>

                <br />
                <mat-checkbox class="example-margin" [(ngModel)]="anomaly.questions.affectingProcesses"
                    name="affectingProcesses">Is this affecting processes? (Safety, Production, Etc.)
                    Yes</mat-checkbox>
                <mat-form-field *ngIf="anomaly.questions.affectingProcesses" class="example-full-width"
                    appearance="fill">
                    <mat-label>Describe the affected processes</mat-label>
                    <textarea autosize [minRows]="3" matInput
                        [(ngModel)]="anomaly.questions.affectingProcessesDescription"
                        name="affectingProcessesDescription"></textarea>
                </mat-form-field>
                <br />
            </div>
            <div class="example-full-width" appearance="fill"
                *ngIf="anomaly.categories.physical || anomaly.categories.digital">
                <mat-checkbox class="example-margin" [(ngModel)]="anomaly.questions.multipleDevices"
                    name="multipleDevices">Were multiple devices involved?
                </mat-checkbox>
                <mat-form-field *ngIf="anomaly.questions.multipleDevices" class="example-full-width" appearance="fill">
                    <mat-label>Describe the devices involved</mat-label>
                    <textarea autosize [minRows]="3" matInput [(ngModel)]="anomaly.questions.multipleDevicesDescription"
                        name="multipleDevicesDescription"></textarea>
                </mat-form-field>
                <br />
            </div>
            <div class="example-full-width" appearance="fill" *ngIf="anomaly.categories.network">
                <mat-checkbox class="example-margin" [(ngModel)]="anomaly.questions.multipleNetworkLayers"
                    name="multipleNetworkLayers">Did the observable event manifest in multiple network
                    layers?</mat-checkbox>
                <mat-form-field *ngIf="anomaly.questions.multipleNetworkLayers" class="example-full-width"
                    appearance="fill">
                    <mat-label>Describe the affected network layers involved</mat-label>
                    <textarea autosize [minRows]="3" matInput [(ngModel)]="
              anomaly.questions.multipleNetworkLayersDescription
            " name="multipleNetworkLayersDescription"></textarea>
                </mat-form-field>
                <br />
            </div>
            <!-- <ul> -->
            <!-- <li> -->
            <!-- <li>
              </li>
              <li>
              </li> -->
            <!-- </ul> -->

            <!-- <mat-radio-group
                  class="radio-group"
                  [(value)]="anomaly.category"
                  aria-labelledby="category-label">
                  <mat-radio-button class="radio-button" value="ics">ICS (Physical Equipment)</mat-radio-button>
                  <mat-radio-button class="radio-button" value="digital">Digital (ICS Process)</mat-radio-button>
                  <mat-radio-button class="radio-button" value="network">Network</mat-radio-button>
                </mat-radio-group> -->
            <!-- </p> -->
        </form>

        <mat-action-row>
            <button *ngIf="!firstAnomaly" mat-button color="warn" (click)="prevStep()">
                Previous
            </button>
            <button *ngIf="!lastAnomaly" mat-button color="primary" (click)="nextStep()">
                {{ !lastAnomaly ? "Next" : "End" }}
            </button>
            <!-- <button mat-button color="primary" (click)="nextStep()">End</button> -->
        </mat-action-row>
    </mat-expansion-panel>
    <!-- </mat-card> -->
</mat-accordion>
<!-- the question asking stuff will happen here -->


<br />
<br />

<div style="
    width: 100%;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
  ">
    <label>Did you observe anything else? </label>

    <button (click)="onAddAnomaly()" mat-raised-button color="accent">
        Add Observable
    </button>
    <!-- matTooltip="Add Observable"
  matTooltipPosition="before" -->

    <!-- <button
      mat-fab
      color="accent"
      class="new-fab"
      (click)="onAddAnomaly()"
      matTooltip="Add Anomaly"
      matTooltipPosition="before"
    >
      <mat-icon>add</mat-icon>
    </button> -->
</div>